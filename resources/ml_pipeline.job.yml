resources:
  jobs:
    ml_pipeline_dev:
      name: ml-pipeline-dev
      permissions:
        - group_name: DataScience-Read-Data
          level: CAN_MANAGE

      tasks:
        - task_key: initialize
          python_wheel_task:
            package_name: databricks-ml-pipelines
            entry_point: initialize-pipeline
            parameters: ["experiment=${var.experiment}"]
          libraries:
            - whl: ../dist/*.whl
          existing_cluster_id: "0609-090345-4rjuomtp"
        - task_key: prepare_data
          depends_on:
            - task_key: initialize
          python_wheel_task:
            package_name: databricks-ml-pipelines
            entry_point: prepare-data
            parameters: ["experiment=${var.experiment}"]
          libraries:
            - whl: ../dist/*.whl
          existing_cluster_id: "0609-090345-4rjuomtp"
        - task_key: train
          depends_on:
            - task_key: prepare_data
          python_wheel_task:
            package_name: databricks-ml-pipelines
            entry_point: train-model
            parameters: ["experiment=${var.experiment}"]
          libraries:
            - whl: ../dist/*.whl
          existing_cluster_id: "0609-090345-4rjuomtp"
        - task_key: evaluate
          depends_on:
            - task_key: train
          python_wheel_task:
            package_name: databricks-ml-pipelines
            entry_point: evaluate-model
            parameters: ["experiment=${var.experiment}"]
          libraries:
            - whl: ../dist/*.whl
          existing_cluster_id: "0609-090345-4rjuomtp"
        - task_key: feature_importance
          depends_on:
            - task_key: train
          python_wheel_task:
            package_name: databricks-ml-pipelines
            entry_point: feature-importance
            parameters: ["experiment=${var.experiment}"]
          libraries:
            - whl: ../dist/*.whl
          existing_cluster_id: "0609-090345-4rjuomtp"
        - task_key: model_qa
          depends_on:
            - task_key: train
          python_wheel_task:
            package_name: databricks-ml-pipelines
            entry_point: model-qa
            parameters: ["experiment=${var.experiment}"]
          libraries:
            - whl: ../dist/*.whl
          existing_cluster_id: "0609-090345-4rjuomtp"
        - task_key: finalize
          depends_on:
            - task_key: model_qa
            - task_key: evaluate
            - task_key: feature_importance
          python_wheel_task:
            package_name: databricks-ml-pipelines
            entry_point: finalize-pipeline
            parameters: ["experiment=${var.experiment}"]
          libraries:
            - whl: ../dist/*.whl
          existing_cluster_id: "0609-090345-4rjuomtp"


